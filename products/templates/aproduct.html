{% extends 'base.html' %}
{% load static from staticfiles %}
{% load static %}

{% block content %}

<div class="container">
    
    <div class="row">
        <div class="col">
            <div id="breadcrumbs" class="col-12">
                <a href="/">Home </a> - 
                <a href="{% url 'products' %}">Products </a>
                - {{ product.name }}
            </div>
        </div>
    </div>

	<div class="row mt-4">

		<div class="col-6">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel" data-interval="false">
                <ol class="carousel-indicators">
                    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                </ol>
                <div class="carousel-inner">
                    <div class="carousel-item active product-image">
                        <img class="d-block w-100" src="{{ MEDIA_URL }}{{ product.image1 }}" alt="First slide">
                    </div>
                    <div class="carousel-item product-image">
                        <img class="d-block w-100" src="{{ MEDIA_URL }}{{ product.image2 }}" alt="Second slide">
                    </div>
                    <div class="carousel-item product-image">
                        <img class="d-block w-100" src="{{ MEDIA_URL }}{{ product.image3 }}" alt="Third slide">
                    </div>
                </div>
                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
	    </div>

        <div class="col-6">
        <div class="row my-2">
            <div class="col-12">
                <div class="row">
                <h3>{{ product.name }}</h3>
                </div>
                <div class="row">
                <p>{{ product.description }}</p>
                </div>
                <div class="row">
                <p>{{ product.price }}</p>
                </div>
                <div class="row">
                {% for star in stars %}
                    {% if star.avg_review %}
                        <div class="div">
                        {% include 'components/starrating.html' %} 
                        </div>
                        {% else %}
                        <div class="div">
                            <h4>No reviews yet for this product</h4>
                        </div>
                    {% endif %} 
                {% endfor %}
                </div>

                <div class="row">
                <form method="post" action="{% url 'cart_add' product.id %}">
                    {% csrf_token %}
                    <div class="input-group">
                        <input name="quantity" type="number" min="1" max="99" required>
                        <span class="input-group-btn">
                        <button class="btn-outline-success" type="submit">Add to Cart</button>
                        </span>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="form-group">
                            <label>Size</label>
                            <select name="size" class="selectpicker" data-title="Select size" 
                            data-style="btn-default btn-block" data-menu-style="dropdown-blue">
                            {% for x,y in form.fields.size.choices %}
                            <option value="{{ x }}">{{ y }}</option>
                            {% endfor %}
                            </select>
                        </div>  
                        </div>
                    </div>
                </form>
                </div>
                </div>
                </div>
            </div>
        </div>

</div>

<div class="container mt-5">
    <div class="row my-2">
        <div class="col-12">
            <a href="{% url 'review_prod' product.id %}" class="btn btn-primary btn-lg active" 
            role="button" aria-pressed="true">Add Review</a>
            </div>
        </div>

    <div class="row my-2">
        <div class="col-12">
            {% if product.productreview_set.count == 0 %}
                <h3>No reviews for this product</h3>
            {% elif product.productreview_set.count == 1 %}
                <h3>{{ product.productreview_set.count }} review for product</h3>
            {% elif product.productreview_set.count > 1 %}
                <h3>{{ product.productreview_set.count }} Product Reviews</h3>
            {% endif %}
            </div>
        </div>

    <div class="row my-2">
        <div class="col-12">
        {% for review in product.productreview_set.all %}
            <h3>{{ review.title }}</h3>
            <p>{{ review.content }}</p>
            <p>{{ review.user }}</p>
            <p>{{ review.date }}</p>
            <p>"{{ review.product }}"</p>
            <p>"{{ review.rating }}/5"</p>
            {% if review.user == user %}
                <a href="{% url 'delete_prod_review' review.id %}" class="btn btn-danger">delete review</a>
                <a href="{% url 'edit_review_prod' review.id  %}" class="btn btn-warning">edit review</a>
            {% endif %}
        {% endfor %}
        </div>
    </div>

</div>
{% endblock %}